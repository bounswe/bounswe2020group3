'use strict';var kva={TAB:0,Nl:1,br:2},Y$=function(a){Ab("MediaRouter.WebRtc.Start.Success",a,kva)};var Z$=function(a,b){Nj.call(this,b);this.H=a;this.l=new Fb;this.g=cx(b.id);this.D=new Fb;this.G=!1;this.o=null;this.C=!1;this.u=this.m=null;lva(this);mva(this);this.g.sendMessage(new Tj("GET_TURN_CREDENTIALS"))};t(Z$,Nj);
Z$.prototype.start=function(a){var b=this;return this.l.promise.then(function(c){if(c.g)return Promise.reject(new Ti("Mirroring already started"));if(b.o)return Promise.reject(new Ti("Session permanently stopped"));b.m=new pb("MediaRouter.WebRtc.Session.Launch");c.ca.addStream(a);c.start();return b.D.promise})};
Z$.prototype.stop=function(){var a=this;this.D.reject(new Ti("Session stop requested."));this.u&&(this.u.end(),this.u=null);if(this.o)return this.o;this.C=this.G=!1;this.m=null;return this.o=this.l.promise.then(function(b){b.stop()}).then(function(){return a.g.dispose()}).catch(function(b){a.g.dispose();throw b;})};
var lva=function(a){a.g.onMessage=function(b){if(!b.type)throw Error("Message has no type.");switch(b.type){case "TURN_CREDENTIALS":a.l.resolve(new Yj(a.h.id,b.data.credentials));break;case "ANSWER":a.l.promise.then(function(c){hk(c,b.data)});break;case "KNOCK_ANSWER":a.C=!0;a.l.promise.then(function(c){hk(c,b.data)});break;case "STOP":a.D.reject(new Ti("Stop signal received"));a.stop();break;default:throw new Ti("Unknown message type: "+b.type);}}},mva=function(a){a.l.promise.then(function(b){ck(b,
function(c){a.g.sendMessage(new Tj("OFFER",new Vj(c,a.H,Wj)))});dk(b,function(c){c=Uj(c);a.g.sendMessage(c)});Zj(b,function(){a.G=!0;a.g.sendMessage(new Tj("SESSION_START_SUCCESS"));!a.C&&a.m&&a.m.end();a.m=null;a.u=new wb("MediaRouter.WebRtc.Session.Length");a.D.resolve(a)});bk(b,function(){a.g.sendMessage(new Tj("SESSION_END"))});ak(b,function(c){a.G||a.D.reject(c);a.g.sendMessage(new Tj("SESSION_FAILURE"))})})};var $$=function(){Bj.call(this,"webrtc")};t($$,Bj);k=$$.prototype;k.Fh=function(a,b){return new Z$(a,b)};k.ih=function(){Y$(0)};k.fh=function(){Y$(1)};k.oi=function(){Y$(2)};k.gh=function(){zb("MediaRouter.WebRtc.Session.End")};k.Yf=function(a){Ab("MediaRouter.WebRtc.Start.Failure",a,Si)};k.hh=function(){zb("MediaRouter.WebRtc.Stream.End")};var nva=new $$;sj("mr.mirror.webrtc.WebRtcService",nva);
